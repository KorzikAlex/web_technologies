# Система входа и страница брокера

## Реализованные функции

### 1. Страница входа (LoginPage)
- **Путь**: `/login`
- **Функционал**:
  - Ввод имени брокера
  - Проверка существования брокера в системе через API
  - Автоматический вход при нажатии Enter
  - Сохранение ID и имени брокера в localStorage
  - Автоматический переход на страницу брокера после успешного входа
  - Отображение ошибок при неверном имени или проблемах с сервером

### 2. Защита маршрутов (authGuard)
- Проверка авторизации перед доступом к защищенным страницам
- Автоматическое перенаправление на `/login` для неавторизованных пользователей
- Автоматическое перенаправление на страницу брокера для авторизованных пользователей, пытающихся зайти на `/login`
- Сохранение сессии в localStorage

### 3. Страница брокера (BrokerPage)
- **Путь**: `/broker/:brokerId`
- **Функционал**:

#### Информационная панель
- Имя брокера
- Текущая дата торгов (получается через WebSocket)
- Кнопка выхода из системы
- Статус подключения к WebSocket

#### Карточки с информацией
- **Баланс**: доступные средства брокера
- **Стоимость портфеля**: общая стоимость всех акций
- **Количество активов**: количество различных акций в портфеле
- **Прибыль/Убыток**: общая прибыль или убыток по всему портфелю

#### Таблица акций на бирже
- Символ акции
- Название акции
- Текущая цена (обновляется в реальном времени через WebSocket)
- Количество акций у брокера
- Действия:
  - **График**: открытие диалога с графиком изменения цены акции
  - **Купить**: открытие диалога покупки
  - **Продать**: открытие диалога продажи (только если у брокера есть акции)

#### Портфель брокера
- Информация по каждой купленной акции:
  - Символ и название
  - Количество акций
  - Цена покупки (средневзвешенная)
  - Текущая цена
  - Общая стоимость
  - Прибыль/Убыток (в рублях и процентах)
  - Цветовая индикация (зеленый - прибыль, красный - убыток)

#### Диалоговые окна

**График акции**:
- Отображение истории изменения цены
- График построен на основе данных из backend

**Торговля (Покупка/Продажа)**:
- Выбор количества акций
- Отображение цены за акцию
- Расчет общей суммы
- Валидация:
  - При покупке: проверка достаточности средств
  - При продаже: проверка наличия акций
- Мгновенное выполнение операции

### 4. Backend API

**Новый endpoint**: `GET /brokers/name/:name`
- Проверка существования брокера по имени
- Возвращает данные брокера с полем `found: true/false`

**Обновленные методы**:
- `buyStock`: теперь сохраняет среднюю цену покупки акций
- `sellStock`: продажа акций по текущей цене

**Структура данных Broker**:
```typescript
interface Broker {
    id?: number;
    name: string;
    balance: number;
    stocks?: Record<string, number>; // symbol -> quantity
    stocksPurchasePrice?: Record<string, number>; // symbol -> average purchase price
}
```

### 5. WebSocket интеграция
- Подключение к серверу при загрузке страницы
- Событие `tradingUpdate`: получение обновлений цен и текущей даты торгов
- Автоматическое обновление цен в таблице и портфеле
- Индикатор статуса подключения

### 6. Особенности реализации

**Безопасность**:
- Пароли не требуются (согласно заданию)
- Простая валидация на существование брокера
- Защита от неавторизованного доступа через authGuard

**UX улучшения**:
- Загрузка состояния при операциях
- Сообщения об ошибках
- Цветовая индикация прибыли/убытков
- Форматирование валюты
- Адаптивный дизайн

**Производительность**:
- Периодическое обновление данных брокера (каждые 10 секунд)
- Реальное время обновления цен через WebSocket
- Computed свойства для оптимизации расчетов

## Использование

1. **Запуск сервера**:
```bash
cd server
bun run start:dev
```

2. **Запуск клиента**:
```bash
cd client
bun run dev
```

3. **Вход в систему**:
   - Откройте `http://localhost:5173/login`
   - Введите имя существующего брокера (например, из файла `server/data/brokers.json`)
   - Нажмите "Войти" или Enter

4. **Работа на бирже**:
   - Просматривайте текущие цены акций
   - Покупайте и продавайте акции
   - Отслеживайте прибыль/убыток
   - Просматривайте графики цен

5. **Выход**:
   - Нажмите кнопку "Выход" в правом верхнем углу
