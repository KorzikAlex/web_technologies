# Система управления биржей - Инструкция по запуску

## Описание реализованного функционала

### 1. Управление настройками биржи
- Настройка даты начала торгов
- Настройка скорости смены дат в секундах (тиков)
- Кнопки "Начать торги" и "Остановить торги"

### 2. Отображение информации о торгах
- Карточка с активными акциями, участвующими в торгах
- Текущая дата торгов (имитируемая)
- Текущая стоимость каждой акции в режиме реального времени

### 3. Имитация торгов
- При запуске торгов система начинает имитировать смену дат
- Каждый тик (согласно заданной скорости) меняется дата
- Для каждой активной акции берется цена открытия (open) из истории по текущей имитируемой дате
- Информация об изменении цен отправляется всем подключенным клиентам через WebSocket

## Структура проекта

```
stock-exchange/
├── server/          # NestJS backend
│   ├── src/
│   │   ├── exchange/     # Модуль управления биржей
│   │   ├── stocks/       # Модуль управления акциями
│   │   ├── brokers/      # Модуль управления брокерами
│   │   └── socket/       # WebSocket gateway
│   └── data/
│       ├── stocks.json   # Данные акций с историей цен
│       ├── brokers.json  # Данные брокеров
│       └── settings.json # Настройки биржи
├── admin/           # React admin панель
│   └── src/
│       ├── pages/ExchangePage.tsx
│       ├── components/
│       │   ├── ExchangeSettingsCard.tsx
│       │   └── cards/ActiveStocksCard.tsx
│       ├── store/slices/exchangeSlice.ts
│       └── services/websocket.ts
└── client/          # Vue.js client приложение
```

## Запуск проекта

### 1. Запуск backend сервера

```bash
cd server
npm install
npm run start:dev
```

Сервер будет доступен на `http://localhost:3000`

### 2. Запуск admin панели

```bash
cd admin
npm install
npm run dev
```

Admin панель будет доступна на `http://localhost:5173`

### 3. Запуск client приложения

```bash
cd client
npm install
npm run dev
```

Client приложение будет доступно на `http://localhost:5174`

## Использование

### Настройка и запуск торгов

1. Откройте admin панель (`http://localhost:5173`)
2. Перейдите на страницу "Биржа" (Exchange)
3. В карточке "Настройки биржи":
   - Выберите дату начала торгов
   - Установите скорость смены дат в секундах (например, 1 секунда)
   - Нажмите "Сохранить настройки"
4. Перейдите на страницу "Акции" (Stocks)
5. Включите акции, которые должны участвовать в торгах (кнопка "Добавить в торги")
6. Вернитесь на страницу "Биржа"
7. В карточке "Активные акции в торгах" вы увидите список включенных акций
8. Нажмите "Начать торги"

### Наблюдение за торгами

После запуска торгов:
- В карточке "Активные акции в торгах" отображается текущая имитируемая дата
- Рядом с каждой акцией отображается её текущая цена
- Цены обновляются автоматически каждый тик через WebSocket
- Кнопка меняется на "Остановить торги"

### Остановка торгов

Нажмите "Остановить торги" для прекращения имитации.

## API Endpoints

### Exchange API
- `GET /exchange/settings` - Получить настройки биржи
- `POST /exchange/settings` - Обновить настройки биржи
- `POST /exchange/start` - Запустить торги
- `POST /exchange/stop` - Остановить торги
- `GET /exchange/state` - Получить текущее состояние торгов

### Stocks API
- `GET /stocks` - Получить список акций
- `GET /stocks/:symbol` - Получить информацию об акции
- `GET /stocks/:symbol/history` - Получить историю цен акции
- `PATCH /stocks/:symbol/enabled` - Включить/выключить акцию в торгах

### Brokers API
- `GET /brokers` - Получить список брокеров
- `POST /brokers/broker` - Создать брокера
- `PATCH /brokers/id/:id` - Обновить брокера
- `DELETE /brokers/id/:id` - Удалить брокера

## WebSocket Events

### Server → Client
- `welcome` - Приветственное сообщение при подключении (включает текущее состояние торгов)
- `tradingUpdate` - Обновление состояния торгов (дата, цены акций)
- `stockPriceUpdate` - Обновление цены отдельной акции

## Технологии

### Backend
- NestJS
- Socket.IO
- TypeScript

### Admin Panel
- React 19
- Redux Toolkit
- Material-UI
- Socket.IO Client
- React Chart.js 2

### Client
- Vue.js 3
- Socket.IO Client
