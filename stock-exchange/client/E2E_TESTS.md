# E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –±–∏—Ä–∂–∏

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –±–∏—Ä–∂–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Playwright (headless-–±—Ä–∞—É–∑–µ—Ä).

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:

1. **–¢–æ—Ä–≥–æ–≤–ª—é –∞–∫—Ü–∏—è–º–∏** ([trading.spec.ts](e2e/trading.spec.ts))
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ N –∞–∫—Ü–∏–π
   - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ N –∞–∫—Ü–∏–π
   - ‚úÖ –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø–æ –∞–∫—Ü–∏—è–º –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
   - ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –ø–æ–∫—É–ø–∫–∞ ‚Üí –æ–∂–∏–¥–∞–Ω–∏–µ ‚Üí –ø—Ä–æ–¥–∞–∂–∞ —Å –ø—Ä–∏–±—ã–ª—å—é
   - ‚úÖ –ü–æ–∫—É–ø–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–∑–Ω—ã—Ö –∞–∫—Ü–∏–π
   - ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞

2. **UI –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª** ([ui.spec.ts](e2e/ui.spec.ts))
   - ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±—Ä–æ–∫–µ—Ä–∞
   - ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (–±–∞–ª–∞–Ω—Å, –∞–∫—Ü–∏–∏, –ø–æ—Ä—Ç—Ñ–µ–ª—å)
   - ‚úÖ –î–∏–∞–ª–æ–≥–∏ –ø–æ–∫—É–ø–∫–∏/–ø—Ä–æ–¥–∞–∂–∏
   - ‚úÖ –ì—Ä–∞—Ñ–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω (—Å –Ω–∞—á–∞–ª–∞ —Ç–æ—Ä–≥–æ–≤)
   - ‚úÖ WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - ‚úÖ –†–∞—Å—á–µ—Ç –ø–æ—Ä—Ç—Ñ–µ–ª—è

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä—ã –¥–ª—è Playwright

```bash
npx playwright install
```

–ò–ª–∏ —Ç–æ–ª—å–∫–æ Chromium (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):

```bash
npx playwright install chromium
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—â–µ–Ω **backend-—Å–µ—Ä–≤–µ—Ä** –Ω–∞ –ø–æ—Ä—Ç—É 3000:

```bash
# –í –ø–∞–ø–∫–µ server/
npm run start:dev
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (headless —Ä–µ–∂–∏–º)
npm test

# –ó–∞–ø—É—Å–∫ —Å UI (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)
npm run test:ui

# –ó–∞–ø—É—Å–∫ –≤ headed —Ä–µ–∂–∏–º–µ (–≤–∏–¥–∏–º—ã–π –±—Ä–∞—É–∑–µ—Ä)
npm run test:headed

# –ó–∞–ø—É—Å–∫ —Å –æ—Ç–ª–∞–¥–∫–æ–π
npm run test:debug

# –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç –æ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Ç–µ—Å—Ç–∞—Ö
npm run test:report
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

```bash
# –¢–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏
npx playwright test trading

# –¢–æ–ª—å–∫–æ UI —Ç–µ—Å—Ç—ã
npx playwright test ui

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
npx playwright test -g "–ü–æ–∫—É–ø–∫–∞ 10 –∞–∫—Ü–∏–π"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
client/
‚îú‚îÄ‚îÄ e2e/
‚îÇ   ‚îú‚îÄ‚îÄ helpers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ broker-helpers.ts     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ trading.spec.ts            # –¢–µ—Å—Ç—ã —Ç–æ—Ä–≥–æ–≤–ª–∏ –∞–∫—Ü–∏—è–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ ui.spec.ts                 # –¢–µ—Å—Ç—ã UI –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
‚îú‚îÄ‚îÄ playwright.config.ts           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Playwright
‚îî‚îÄ‚îÄ package.json
```

## üîç –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ –∑–∞–¥–∞–Ω–∏—é

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ

```typescript
test('–ü–æ–∫—É–ø–∫–∞ 10 –∞–∫—Ü–∏–π AAPL - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞', async ({ page }) => {
    const initialBalance = await getBrokerBalance(page);
    const currentPrice = await getCurrentStockPrice(page, 'AAPL');
    
    await buyStock(page, 'AAPL', 10);
    
    const newBalance = await getBrokerBalance(page);
    const expectedCost = currentPrice * 10;
    const actualCost = initialBalance - newBalance;
    
    expect(isWithinRange(actualCost, expectedCost, 0.1)).toBeTruthy();
});
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã

```typescript
test('–†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –∞–∫—Ü–∏–∏', async ({ page }) => {
    const purchasePrice = await getCurrentStockPrice(page, 'META');
    await buyStock(page, 'META', 100);
    
    // –ñ–¥–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã —á–µ—Ä–µ–∑ WebSocket
    await waitForPriceUpdate(page, 3000);
    
    const newPrice = await getCurrentStockPrice(page, 'META');
    const profitLoss = await getStockProfitLoss(page, 'META');
    const expectedProfitLoss = (newPrice - purchasePrice) * 100;
    
    expect(isWithinRange(profitLoss, expectedProfitLoss, 1.0)).toBeTruthy();
});
```

## üõ†Ô∏è –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

–í —Ñ–∞–π–ª–µ [broker-helpers.ts](e2e/helpers/broker-helpers.ts) –¥–æ—Å—Ç—É–ø–Ω—ã:

- `loginAsBroker(page, brokerId)` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- `getBrokerBalance(page)` - –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å
- `getStockQuantity(page, symbol)` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ü–∏–π –≤ –ø–æ—Ä—Ç—Ñ–µ–ª–µ
- `getCurrentStockPrice(page, symbol)` - –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ –∞–∫—Ü–∏–∏
- `getStockProfitLoss(page, symbol)` - –ü—Ä–∏–±—ã–ª—å/—É–±—ã—Ç–æ–∫ –ø–æ –∞–∫—Ü–∏–∏
- `buyStock(page, symbol, quantity)` - –ö—É–ø–∏—Ç—å –∞–∫—Ü–∏–∏
- `sellStock(page, symbol, quantity)` - –ü—Ä–æ–¥–∞—Ç—å –∞–∫—Ü–∏–∏
- `waitForPriceUpdate(page, timeout)` - –û–∂–∏–¥–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ [playwright.config.ts](playwright.config.ts):

- **baseURL**: `http://localhost:5173` (–∫–ª–∏–µ–Ω—Ç)
- **timeout**: 60 —Å–µ–∫—É–Ω–¥ –Ω–∞ —Ç–µ—Å—Ç
- **webServer**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ dev-—Å–µ—Ä–≤–µ—Ä–∞
- **reporter**: HTML –æ—Ç—á–µ—Ç + –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
- **–±—Ä–∞—É–∑–µ—Ä—ã**: Chromium (–º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Firefox, WebKit)

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

```bash
npm run test:debug
```

–û—Ç–∫—Ä–æ–µ—Ç—Å—è Playwright Inspector –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–π –æ—Ç–ª–∞–¥–∫–∏.

### –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞

–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è:

- –°–∫—Ä–∏–Ω—à–æ—Ç
- –í–∏–¥–µ–æ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
- –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ (trace)

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫—É:

```bash
npx playwright show-trace test-results/[test-name]/trace.zip
```

### –õ–æ–≥–∏

–í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–≤–æ–¥—è—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏:

```typescript
console.log(`–ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å: ${formatCurrency(initialBalance)} ‚ÇΩ`);
console.log(`–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ AAPL: ${formatCurrency(currentPrice)} ‚ÇΩ`);
console.log(`–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–∫—É–ø–∫–∏: ${formatCurrency(expectedCost)} ‚ÇΩ`);
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω**: –¢–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–±–æ—Ç–∞—é—â–∏–π backend –Ω–∞ `http://localhost:3000`

2. **–°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∏—Ä–∂–∏**: –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ—Ä–≥–∏ –∑–∞–ø—É—â–µ–Ω—ã –∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –∞–∫—Ü–∏–∏

3. **–¢–∞–π–º–∞—É—Ç—ã**: –¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `waitForTimeout()` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π. –ï—Å–ª–∏ —Ç–æ—Ä–≥–∏ –∏–¥—É—Ç –º–µ–¥–ª–µ–Ω–Ω–æ, —É–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã

4. **–¶–µ–Ω—ã –º–µ–Ω—è—é—Ç—Å—è**: –¢–µ—Å—Ç—ã —É—á–∏—Ç—ã–≤–∞—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–æ–ø—É—Å–∫ (tolerance) –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏

5. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (`workers: 1`) –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

## üìà –ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –æ—Ç–∫—Ä–æ–π—Ç–µ HTML –æ—Ç—á–µ—Ç:

```bash
npm run test:report
```

–û—Ç—á–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:

- –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏

## üéØ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–¥–∞–Ω–∏—é

‚úÖ **–ü—É–Ω–∫—Ç 7 –∑–∞–¥–∞–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é:**

- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º headless-–±—Ä–∞—É–∑–µ—Ä–∞ (Playwright)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ/–ø—Ä–æ–¥–∞–∂–µ N –∞–∫—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–±—ã–ª–∏/—É–±—ã—Ç–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –¥–∞—Ç—ã —Ç–æ—Ä–≥–æ–≤ (—á–µ—Ä–µ–∑ WebSocket)
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ UI, –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Playwright](https://playwright.dev/)
- [Best Practices](https://playwright.dev/docs/best-practices)
- [–õ–æ–∫–∞—Ç–æ—Ä—ã](https://playwright.dev/docs/locators)
- [–ê—Å—Å–µ—Ä—Ç—ã](https://playwright.dev/docs/test-assertions)
