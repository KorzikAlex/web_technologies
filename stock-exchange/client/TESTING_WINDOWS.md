# Пример запуска E2E тестов в Windows PowerShell

## Шаг 1: Установка зависимостей (однократно)

```powershell
# Перейти в папку client
cd client

# Установить npm пакеты
npm install

# Установить браузеры Playwright
npx playwright install chromium
```

## Шаг 2: Запуск backend-сервера

Откройте новое окно PowerShell и выполните:

```powershell
# Перейти в папку server
cd server

# Запустить сервер
npm run start:dev
```

**Дождитесь сообщения:** `WebSocket Gateway initialized` и `Application is running on: http://[::1]:3000`

## Шаг 3: Запуск тестов

В первом окне PowerShell (в папке client):

```powershell
# Запуск всех тестов
npm test

# ИЛИ с интерактивным UI (рекомендуется для первого раза)
npm run test:ui
```

## Шаг 4: Просмотр результатов

```powershell
# Открыть HTML отчет (создается автоматически после тестов)
npm run test:report
```

## Пример вывода успешного теста

```text
Running 13 tests using 1 worker

  ✓ Торговля акциями - покупка и продажа > Покупка 10 акций AAPL - проверка изменения баланса (5s)
  ✓ Торговля акциями - покупка и продажа > Продажа 5 акций MSFT - проверка изменения баланса (7s)
  ✓ Торговля акциями - покупка и продажа > Расчет прибыли/убытка после изменения цены акции (8s)
  ...

  13 passed (2m)
```

## Дополнительные команды

```powershell
# Запуск только тестов торговли
npx playwright test trading

# Запуск только UI тестов
npx playwright test ui

# Запуск конкретного теста
npx playwright test -g "Покупка 10 акций"

# Запуск с видимым браузером (не headless)
npm run test:headed

# Запуск с пошаговой отладкой
npm run test:debug
```

## Устранение проблем

### Ошибка: "Cannot connect to http://localhost:5173"

**Решение:** Playwright автоматически запускает dev-сервер. Если видите эту ошибку, подождите ~30 секунд или запустите клиент вручную:

```powershell
# В отдельном окне PowerShell
cd client
npm run dev
```

### Ошибка: "Cannot connect to http://localhost:3000"

**Решение:** Backend не запущен. Выполните Шаг 2.

### Ошибка: "Executable doesn't exist at ..."

**Решение:** Браузеры не установлены. Выполните:

```powershell
npx playwright install chromium
```

### Тесты падают из-за таймаутов

**Решение:** Убедитесь, что:

1. Торги запущены на бирже (админ панель → Запустить торги)
2. Есть активные акции (хотя бы 2-3 акции enabled=true)
3. Компьютер не перегружен (закройте лишние приложения)

## Просмотр логов тестов

Каждый тест выводит подробные логи в консоль:

```text
Начальный баланс: 1 000 000,00 ₽
Текущая цена AAPL: 176,04 ₽
Ожидаемая стоимость покупки: 1 760,40 ₽
Новый баланс: 998 239,60 ₽
Фактическая стоимость покупки: 1 760,40 ₽
```

## Полезные ссылки

- [Подробная документация по тестам](E2E_TESTS.md)
- [Документация Playwright](https://playwright.dev/)
- [README проекта](README.md)
