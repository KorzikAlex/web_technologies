extends layout

block head
    title Фотографии - Социальная сеть

block content
    include components/_sidebar
    .d-flex
        +sidebar({active: 'photos', user: user})

        .flex-grow-1.bg-light.min-vh-100
            .container.py-4
                h2.mb-4 Мои фотографии

                .mb-3
                    button.btn.btn-primary#uploadPhotoBtn
                        i.bi.bi-upload.me-2
                        | Загрузить фото

                .row.g-3
                    each photo in photos
                        .col-md-4.col-lg-3
                            .card.h-100
                                img.card-img-top(src=photo.url style="height: 200px; object-fit: cover")
                                .card-body
                                    p.card-text.small= photo.caption || 'Без описания'
                                    small.text-muted= new Date(photo.createdAt).toLocaleDateString()
                                if user.role === 'admin'
                                    .card-footer
                                        .btn-group.w-100
                                            button.btn.btn-sm(class=photo.status === 'active' ? 'btn-success' : 'btn-secondary' onclick=`togglePhotoStatus(${photo.id}, 'active')`) Активна
                                            button.btn.btn-sm(class=photo.status === 'blocked' ? 'btn-danger' : 'btn-secondary' onclick=`togglePhotoStatus(${photo.id}, 'blocked')`) Заблокирована

    script.
        async function togglePhotoStatus(photoId, status) {
            await fetch(`/api/photos/${photoId}/status`, {
                method: 'PATCH',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({status})
            });
            location.reload();
        }
