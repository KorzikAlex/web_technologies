# Тесты для серверной части

## Описание

В проекте реализованы автоматические тесты для серверной части приложения с использованием **Jest** и **TypeScript**.

## Структура тестов

Тесты находятся в директории `src/server/__tests__/` и покрывают два основных менеджера:

### 1. UserManager (7 тестов)

**Файл:** `UserManager.test.ts`

#### Покрытие:

- ✅ **createUser** - создание нового пользователя
  - Проверка корректности создания пользователя с заполненными полями
  - Проверка автоматической генерации уникальных ID

- ✅ **getUserById** - получение пользователя по ID
  - Получение существующего пользователя
  - Возврат null для несуществующего ID

- ✅ **getUserByUsername** - поиск пользователя по username
  - Проверка корректного поиска по уникальному имени

- ✅ **updateUser** - обновление данных пользователя
  - Обновление существующих полей
  - Сохранение неизменённых полей

- ✅ **getAllUsers** - получение всех пользователей
  - Возврат полного списка пользователей

- ✅ **addFriend** - добавление друга
  - Добавление пользователя в список друзей
  - Проверка защиты от добавления себя в друзья

### 2. PostsManager (13 тестов)

**Файл:** `PostsManager.test.ts`

#### Покрытие:

- ✅ **addPost** - создание нового поста
  - Создание поста с полными данными (включая изображение)
  - Автоматическая генерация уникальных ID
  - Создание поста без изображения

- ✅ **getAllPosts** - получение всех постов
  - Возврат списка всех постов
  - Возврат пустого массива при отсутствии постов

- ✅ **updatePost** - обновление поста
  - Обновление содержимого существующего поста
  - Возврат false при попытке обновить несуществующий пост

- ✅ **deletePost** - удаление поста
  - Удаление существующего поста
  - Возврат false при попытке удалить несуществующий пост

- ✅ **deletePostsByAuthorId** - удаление всех постов автора
  - Удаление всех постов конкретного пользователя
  - Возврат 0 при отсутствии постов у автора

## Запуск тестов

### Установка зависимостей

```bash
npm install
```

### Команды для запуска

```bash
# Запустить все тесты
npm test

# Запустить тесты в режиме наблюдения (watch mode)
npm run test:watch

# Запустить тесты с отчётом о покрытии
npm run test:coverage
```

## Результаты выполнения

```text
Test Suites: 2 passed, 2 total
Tests:       20 passed, 20 total
Snapshots:   0 total
Time:        ~1s
```

## Технологии

- **Jest** - фреймворк для тестирования
- **ts-jest** - пресет для работы с TypeScript
- **@types/jest** - типы TypeScript для Jest

## Особенности реализации

1. **Изоляция тестов** - каждый тест работает с чистой тестовой базой данных
2. **Бэкап данных** - перед тестами создаётся резервная копия, которая восстанавливается после выполнения
3. **beforeEach/afterAll** - использование хуков Jest для подготовки и очистки данных
4. **Покрытие CRUD операций** - все основные операции создания, чтения, обновления и удаления покрыты тестами

## Что проверяют тесты

### Функциональность:
- ✅ Корректность создания сущностей (пользователи, посты)
- ✅ Правильность получения данных по различным критериям
- ✅ Корректность обновления существующих записей
- ✅ Корректность удаления записей
- ✅ Обработка граничных случаев (несуществующие ID, пустые списки)

### Бизнес-логика:
- ✅ Автоматическая генерация ID
- ✅ Установка значений по умолчанию (статус, друзья)
- ✅ Валидация данных (защита от добавления себя в друзья)
- ✅ Каскадное удаление (удаление постов при удалении автора)

## Преимущества автоматического тестирования

1. **Уверенность в коде** - тесты подтверждают, что код работает корректно
2. **Быстрое обнаружение ошибок** - регрессии обнаруживаются сразу
3. **Документация** - тесты служат живой документацией API
4. **Безопасный рефакторинг** - изменения кода можно вносить без страха всё сломать
5. **Экономия времени** - автоматические проверки быстрее ручного тестирования
